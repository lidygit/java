# GC
## 串行GC
单线程垃圾回收，对年轻代使用mark-copy算法，对老年代使用mark-sweep-compact算法，垃圾回收时会触发全线暂停

- 优点：简单高效，对于限定单个CPU环境来说，没有线程交互的开销，可以获得最高的单线程垃圾收集效率

- 缺点：单线程工作，且在垃圾收集的同时必须暂停其他所有的工作线程知道垃圾收集结束

- ParNew:改进版本的Serial GC，Serial+多线程，可以配合CMS使用，默认开启和CPU数目相同的线程数，可以通过-XX:ParallelGCThreads参数来限制垃圾收集器的线程数

## 并行GC
JDK6 7 8的默认GC，采用多线程，重点关注的是程序达到一个可控制的吞吐量，高吞吐量可以最高效率地利用CPU时间，尽快完成程序的运算任务，主要适用于在后台运算而不需要太多交互的任务。自适应调节策略。默认开启和CPU数目相同的线程数，可以通过-XX:ParallelGCThreads参数来限制垃圾收集器的线程数

- 优点：吞吐量高 吞吐量=运行用户代码时间/(运行用户代码时间+垃圾收集时间)）

- 缺点：会触发STW

## CMS GC
主要目标是避免在老年代垃圾收集长时间卡顿，主要通过两种手段：1 .不对老年代进行整理，而是使用空闲列表管理内存空间的回收； 2.在mark-and-sweep阶段的大部分工作和应用线程一起并发执行。默认开启CPU数目1/4的线程。 进行老年代的并发回收时，可能会伴随着多次年轻代的minorGC。

- CMS的6个阶段：其中初始标记和最终标记会触发STW
	- 初始标记（根对象及其直接引用的对象、年轻代指向老年代的   Rset）
	- 并发标记（遍历老年代，标记存活对象）
	- 并发预清理（标记改变的区域：脏区）
	- 最终标记
	- 并发清除（清除GCRoots不可达对象）
	- 并发重置（重置JVM内部CMS相关的数据和状态）

- 优点：可以并发清理垃圾

- 缺点：老年代内存碎片问题（因为未对老年代内存进行压缩整理）；某些情况下GC会造成不可预测的暂停时间，特别是堆内存较大时

## G1 GC
不再分年轻代和老年代，而实划分为多个（通常是2048个）小块Region，每个小块可能一会被定义为Eden区，一会被定义为S区或者Old区。避免全区域垃圾回收，优先清理垃圾最多的region，可以使用-XX:MaxGCPauseMillis=size控制每次垃圾回收的时间

- 优点：STW停顿的时间和分布可预期且可配置，在不牺牲吞吐量的前提下实现低停顿垃圾回收。基于标记整理算法，不产生内存碎片。

- 缺点：某些情况下G1触发了Full GC，会退化成为串行GC

    - 并发模式失败：G1启动标记周期，但是在MixGC之前，老年代就被填满，这时G1会放弃标记周期
         - 解决：增加堆内存大小或者调整周期（如增加GC线程数 -XX：ConcGCThreads）
         
    - 晋升失败：没有足够的内存供存活对象或晋升对象使用，由此触发了fullGC

         - 解决：1.增加-XX:G1ReservePercent选项的值，增加预留内存量； 2.通过减少-XX:InitiatingHeapOccupancyPercent提前启动标记周期； 3.通过增加-XX:ConcGCTHreads值增加并行标记线程的数目
         
     - 巨型对象分配失败：当巨型对象找不到何使的空间进行分配时，会启动full GC
     
         - 解决：增大内存或增大-XX:G1HeapRegionSize


# 堆内存
- 可使用-Xms和-Xmx分配初始堆内存和最大堆内存

- 堆内存分为年轻代和老年代，可使用-Xmn设置年轻代大小，一般设置为Xmx的1/3。

- 年轻代分为Eden区和两个Servivor区，比例为8：1：1，Eden区是java对象的出生地（如果新创建的对象很大，会直接放到老年代），两个S区每次只使用其中一个。当Eden区不够时会触发minor GC，对新生代区进行一次垃圾回收，采用复制算法将Eden区和ServivorFrom区存活对象复制到ServivorTo区，同时将这些对象的年龄+1（如果ServivorTo不够会放到老年区），然后清空Eden区和ServivorFrom。由于频繁创建对象，所以年轻代会频繁触发 MinorGC 进行垃圾回收。

- 老年代用于存放应用程序中生命周期较长的对象，老年带的对象比较稳定，所以MajorGC不会频繁执行。在进行MajorGC前一般都先进行了Minor GC，使得有新生代晋升为老年代，导致空间不够用时才触发。当无法找到足够大的连续空间分配给新创建的较大对象时也会提前触发一次Major GC进行垃圾回收腾出空间。

- 当老年代也满了会抛出OOM异常
